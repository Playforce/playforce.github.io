<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Flaggen-Quiz</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background: #f4f4f4;
      padding: 20px;
    }
    #flag {
      width: 300px;
      height: 200px;
      margin: 20px auto;
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      border: 2px solid #ccc;
    }
    .options, #inputMode {
      max-width: 300px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    button, input {
      padding: 10px;
      font-size: 16px;
      cursor: pointer;
    }
    #result {
      margin-top: 20px;
      font-weight: bold;
    }
    #modeToggle {
      margin-bottom: 20px;
      cursor: pointer;
      color: blue;
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <h1>üåç Flaggen‚ÄëQuiz</h1>
  <div id="modeToggle">Zum Freitext-Modus wechseln</div>
  <div id="flag"></div>
  <div class="options" id="options"></div>
  <div id="inputMode" style="display:none;">
    <input id="textAnswer" type="text" placeholder="Land eingeben‚Ä¶" />
    <button id="submitText">Antwort pr√ºfen</button>
    <button id="skip">√úberspringen</button>
  </div>
  <div id="result"></div>

  <script>
    let countries = [], correct = null, mode = 'mc';

    async function loadCountries() {
      try {
        const proxy = 'https://api.allorigins.win/raw?url=';
        const apiUrl = 'https://restcountries.com/v3.1/all';
        const res = await fetch(proxy + encodeURIComponent(apiUrl));
        const data = await res.json();
        countries = data.map(c => ({
          name: c.name.common,
          code: c.cca2?.toLowerCase()
        })).filter(c => c.code); // Nur L√§nder mit g√ºltigem Code
        nextQuestion();
      } catch (e) {
        document.body.innerHTML = '<p>‚ùå Fehler beim Laden der L√§nder-Daten (CORS).</p>';
        console.error(e);
      }
    }

    function shuffle(a) {
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
    }

    function nextQuestion() {
      document.getElementById('result').textContent = '';
      correct = countries[Math.floor(Math.random() * countries.length)];
      const flagUrl = `https://flagcdn.com/w320/${correct.code}.png`;
      document.getElementById('flag').style.backgroundImage = `url(${flagUrl})`;
      if (mode === 'mc') setupMC(); else setupText();
    }

    function setupMC() {
      const opts = [correct.name];
      shuffle(countries);
      for (const c of countries) {
        if (opts.length >= 4) break;
        if (c.name !== correct.name) opts.push(c.name);
      }
      shuffle(opts);
      const div = document.getElementById('options');
      div.innerHTML = '';
      opts.forEach(name => {
        const b = document.createElement('button');
        b.textContent = name;
        b.onclick = () => answer(name === correct.name);
        div.appendChild(b);
      });
      document.getElementById('options').style.display = 'flex';
      document.getElementById('inputMode').style.display = 'none';
    }

    function setupText() {
      document.getElementById('options').style.display = 'none';
      document.getElementById('inputMode').style.display = 'flex';
      document.getElementById('textAnswer').value = '';
    }

    function answer(ok) {
      const res = document.getElementById('result');
      res.textContent = ok ? '‚úÖ Richtig!' : `‚ùå Falsch! Richtige Antwort: ${correct.name}`;
      setTimeout(nextQuestion, 1500);
    }

    document.getElementById('submitText').onclick = () => {
      const ans = document.getElementById('textAnswer').value.trim().toLowerCase();
      answer(ans === correct.name.toLowerCase());
    };

    document.getElementById('skip').onclick = nextQuestion;

    document.getElementById('modeToggle').onclick = () => {
      mode = (mode === 'mc') ? 'text' : 'mc';
      document.getElementById('modeToggle').textContent =
        mode === 'mc' ? 'Zum Freitext-Modus wechseln' : 'Zum Multiple‚ÄëChoice‚ÄëModus wechseln';
      nextQuestion();
    };

    // Lade L√§nder beim Start
    loadCountries();
  </script>
</body>
</html>
